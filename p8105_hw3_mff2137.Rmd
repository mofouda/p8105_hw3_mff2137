---
title: "p8105_hw3_mff2137"
author: "Mohammad Fouda"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)
library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1

## Read in the data from `p8105.datasets`

```{r}
data("instacart")

instacart <-
  instacart %>% 
  as_tibble(instacart)
```

## Answers to the questions about the data

This dataset contains `r nrow(instacart)` rows and `r ncol(instacart)` columns, 
with each row resprenting a single product from an instacart order. Variables 
include identifiers for the user and the order as well as the order in which each
product was added to the cart and the product name. There are some order-related
variables such as time of the order, and number of days since prior order. In 
addition, there are variables about  the products such as name, department 
(e.g. dairy and eggs, produce), and aisle (e.g. yogurt, fresh fruits). In total, 
there are `r instacart %>% select(product_id) %>% distinct %>% count` products 
found in `r instacart %>% select(user_id, order_id) %>% distinct %>% count` orders
from `r instacart %>% select(user_id) %>% distinct %>% count` distinct users.

Below is a table summarizing the number of items ordered from aisle. In total, 
there are 134 aisles, with fresh vegetables and fresh fruits holding the most 
items ordered by far.

```{r}
instacart %>% 
  count(aisle) %>% 
  arrange(desc(n))
```

Next is a plot that shows the number of items ordered in each aisle. Here, aisles
are ordered by ascending number of items.

```{r}
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, n)) %>% 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() + 
  labs(title = "Number of items ordered in each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```

Our next table shows the three most popular items in aisles `baking ingredients`,
`dog food care`, and `packaged vegetables fruits`, and includes the number of 
times each item is ordered in your table.

```{r}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(desc(n)) %>%
  knitr::kable()
```

Finally is a table showing the mean hour of the day at which Pink Lady Apples 
and Coffee Ice Cream are ordered on each day of the week. This table has been
formatted in an untidy manner for human readers. Pink Lady Apples are generally
purchased slightly earlier in the day than Coffee Ice Cream, with the exception
of day 5.

```{r}
instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarize(mean_hour = mean(order_hour_of_day)) %>%
  pivot_wider(
      names_from = order_dow, 
      values_from = mean_hour) %>%
  knitr::kable(digits = 2)
```

# Problem 2

## Importing and tidying the data

This code chunk imports and cleans the `accel_data` dataset, then switch it from
the wide to the long format to make it easier to manipulate, then, creates a new
variable `weekday_vs_weedend` to identify if the day the activity is measured falls
on a weekend or a weekday.  

```{r}
accel <-
    read.csv("data/accel_data.csv") %>% 
    janitor::clean_names() %>%
    pivot_longer(
        activity_1:activity_1440,
        names_to = "minute",
        values_to = "n_activities",
        names_prefix = "activity_"
        ) %>% 
    mutate(
        weekday_vs_weekend = if_else(
            day %in% c("Saturday", "Sunday"), "weekend", "weekday"),
        minute= as.integer(minute),
        day = factor(day))
```


## Answering questions about the data 

The resulting dataset has `r nrow(accel)` rows and 
`r ncol(accel)` columns. Some of the key variables include week, day identifier, 
the minute at which the activity is measured , and the number of activities at 
each minute of each day. There's also a variable that identifiers if the day on which 
activities are measured falls in a weekday vs a weekend.

Below is a code that aggregates across minutes and creates a total activities per 
day variable. Results are shown in the table, demonstrate a higher number of total 
activities in the last 3 weekdays (Wednesday through Friday).


```{r}
accel %>% 
    group_by(day) %>% 
    summarize(
        total_act = sum(n_activities)) %>% 
    arrange(total_act) %>% 
    knitr::kable()
```


Next, making a single-panel plot that shows the 24-hour activity time courses for
each day using color to indicate day of the week.

```{r}
accel %>% 
    filter(n_activities < 2500) %>%
    ggplot(aes(x = minute, y = n_activities, color = day)) + 
    geom_point(alpha = .7) +
    geom_smooth(se = FALSE) +
    labs(
    title = "Activity plot",
    x = "Minute of the day",
    y = "Number of activities",
    caption = "Data from CUMC") + 
  scale_x_continuous(
    breaks = c(250, 500, 750, 1000, 1250, 1500))
```

Alternatively, the plot below has the same variables and data but less crowded
which could be more informative. 

```{r}
accel %>% 
    filter(n_activities < 2500) %>% 
    ggplot(aes(x = minute, y = n_activities, color = day)) + 
    geom_smooth(se = FALSE) +
    labs(
    title = "Activity plot",
    x = "Minute of the day",
    y = "Number of activities",
    caption = "Data from CUMC") + 
  scale_x_continuous(
    breaks = c(250, 500, 750, 1000, 1250, 1500))
```

Based on the plots above shows that the number of activities tend to markedly 
increase around minute 250 in across all days then fluctuates as the day progress
while staying just above 200 activities, then a marked decrease around minute 1300 
of the day. While the data shows that number of activities is higher in certain 
days (Wednesday, Thursday, Friday), these patterns aligns with the normal activity
cycle expected along the day(i.e. increase in number during the day and early 
hours of the night and very low outside these times).
